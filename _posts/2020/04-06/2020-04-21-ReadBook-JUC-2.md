---
layout: post
title: 读书笔记之《Java并发编程的艺术》
category: 读书笔记
tags: [读书笔记]
no-post-nav: true
---

前言

&ensp;&ensp;&ensp;&ensp;这本书集合JDK的源码讲了Java并发框架、线程池的原理等，深入到JVM、CPU层面来讲解。推荐看过《Java多线程编程核心技术》
之后，可以继续研究此书，提高自己。全书分为11章，下面将记录个人认为每章中重要的知识点。

一、并发编程的挑战

&ensp;&ensp;&ensp;&ensp;并发编程的目的是为了让程序执行的更快，并不是启动更多的线程就能让程序最大限度的并发执行。需要考虑很多因素，比如
上下文切换、死锁，以及硬件和软件资源的限制。

1、上下文切换

CPU通过时间片分配算法来循环执行任务，当前任务执行完一个时间片后会切换到下一个任务，切换前会保存上一个任务的状态。任务从保存到再加载的过程
就是一次上下文切换。上下文切换会影响多线程的执行速度。

(1)如何减少上下文切换？

减少上下文切换的方法有无锁并发编程、CAS算法、使用最少线程和使用协程：

无锁并发编程：多线程竞争锁时，会引起上下文切换，所以多线程处理数据时，可以用一些方法来避免使用锁。<br/>
CAS算法：Atomic包使用CAS算法来更新数据，不需要加锁。<br/>
使用最少线程：避免创建不需要的线程，比如任务很少，如果创建了很多线程，那么会造成大量线程处于等待状态。<br/>
协程：在单线程里实现多任务的调度，并在单线程里维持多个任务间的切换。

注意：可以通过减少WAITING的线程，来减少上下文切换次数。因为每一次WAITING到RUNNABLE都会进行一次上下文的切换。

2、死锁

避免死锁的几个方法：

避免一个线程同时获取多个锁；<br/>
避免一个线程在锁内同时占用多个资源，尽量保证每个锁只占用一个资源；<br/>
尝试使用定时锁，使用lock.tryLock(timeout)来代替使用内部锁机制；<br/>
对于数据库锁，加锁和解锁必须在一个数据库里，否则会出现解锁失败的情况。

3、资源限制的挑战

(1)资源限制的含义

资源限制是指进行并发编程时，程序的执行速度受限于硬件资源和软件资源。硬件资源的限制有带宽的上传、下载速度，磁盘的读写速度和CPU的处理
速度；软件资源限制有数据库的连接和socket连接数等。

(2)资源限制引发的问题

代码执行速度加快的原则是将代码中串行执行的部分变成并发执行，如果因为资源受限的原因，将某段串行的代码改为并发执行，效率反而会慢下来，
因为上下文切换和资源调度都需要时间。

(3)如何解决资源限制的问题

硬件资源的限制可以通过集群的方式解决；软件资源的限制可以考虑使用资源池将资源复用。

(4)在资源限制情况下进行并发编程

根据不同的资源限制调整程序的并发度。


二、Java并发机制的底层实现原理

Java中所使用的并发机制依赖于JVM的实现和CPU的指令。

1、volatile

2、synchronized





